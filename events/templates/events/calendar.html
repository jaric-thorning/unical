<!-- cal/templates/cal/calendar.html -->


{% extends 'base.html' %}
{% load static %}


<script>
{% block jquery %}


$('#searchBar').each(function() {
   var elem = $(this);

   // Save current value of element
   elem.data('oldVal', elem.val());

   // Look for changes in the value
   elem.bind("propertychange change click keyup input paste", function(event){
      // If value has changed...
      if (elem.data('oldVal') != elem.val()) {
       // Updated stored value
       elem.data('oldVal', elem.val());

       console.log(elem.val())

       
       var results = []

       var endpoint = '/api/searchEvents?term=' + elem.val()

       $.ajax({
		    method: "GET",
		    url: endpoint,
		    dataType: 'json', 
		    success: function(data){
		        results = data.results
		        console.log(results[0])
		        if(results.length > 0){
		        	updateText(results[0])
		    	} else {
		    		updateText("No result")
		    	}

		    },
		    error: function(error_data){
		        console.log("error")
		        console.log(error_data)
		    }
		})


       


     }
   });
 });

function updateText(text){
	document.getElementById("result").innerHTML = text
}


// POP UP BOX

// Get the modal
var modal = document.getElementById("myModal");

// Get the button that opens the modal
var btn = document.getElementById("myBtn");

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

// When the user clicks on the button, open the modal 
btn.onclick = function() {
  modal.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}


{% endblock %}
</script>


{% block content %}

<div id = "container_id">

	<div  id="header">

		<img class="logo" src="{% static '/events/logo.png' %}">
		<h1 id="title">UniCal</h1>
		<p id="sub-title">University Event Calendar</p>
		<hr>	
	</div>


	<div id="left">

		<div id=miniCalendar>

			<p id="miniCalendarMonth" style="float: left;">{{ miniCalendarMonth }}</p>

			<div id='minibuttonbox' style="float: right;"> 
				<a class="minibtn" href="{% url 'calendar' %}?{{ prev_month }}"><</a>
				<a class="minibtn" href="{% url 'calendar' %}?{{ next_month }}">></a>
			</div>

			<table id="miniCalendarTable">
			    <thead>
			        <tr class="miniCalendarEntry">
			            {% for k in miniCalendarHeader %}
			            <th>{{k}}</th>
			            {% endfor %}
			        </tr>
			    </thead>
			    <tbody>
			        {% for r in miniCalendarRows %}
			            <tr class="miniCalendarEntry">
			                <td class='date'>{{r.mon}}</td>
			                <td class='date'>{{r.tue}}</td>
			                <td class='date'>{{r.wed}}</td>
			                <td class='date'>{{r.thu}}</td>
			                <td class='date'>{{r.fri}}</td>
			                <td class='date'>{{r.sat}}</td>
			                <td class='date'>{{r.sun}}</td>
			            </tr>
			        {% endfor %}
			    </tbody>
			</table>

		</div>
		
		<hr>

	
		<div class="ui-widget">
			<input id="searchBar" placeholder="Search Clubs">
		</div>


			
		<p id=result>Test </p>
	
	
		<table class="table">
		    <thead>
		        <tr>
		            {% for k in clubTableHeader %}
		            <th>{{k}}</th>
		            {% endfor %}
		        </tr>
		    </thead>
		    <tbody>
		        {% for r in clubTableRows %}
		            <tr class="clubEntry">
		                <td id="myBtn2">{{r.name}}</td>
		            </tr>
		        {% endfor %}
		    </tbody>
		</table>


		<!-- Trigger/Open The Modal -->
		<button id="myBtn">Open Modal</button>

		<!-- The Modal -->
		<div id="myModal" class="modal">

		  <!-- Modal content -->
		  <div class="modal-content">
		    <span class="close">&times;</span>
		    <p>Some text in the Modal..</p>
		  </div>

		</div>



	</div>


	<div id="right">	

		<dir id='buttonbox'> 
			<a class="monthButton" href="{% url 'calendar' %}?{{ next_month }}"> Next<br>Month </a>
			<a class="monthButton" href="{% url 'calendar' %}?{{ prev_month }}"> Previous<br>Month </a>
		</dir>


		<div class = "calendarBlock">
			{{ calendar }}
		</div>

	</div>


<hr>
</div>

{% endblock %}